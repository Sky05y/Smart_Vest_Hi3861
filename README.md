# 智慧农业健康环境监测系统

##  项目简介

本项目是一个基于 BearPi-HM Nano 只能背心降温系统。系统融合了多个传感器模块，通过串口读取 GPS 定位信息，采集环境温湿度、心率和血氧饱和度数据，控制降温模块的开关，并通过华为云 IoT 平台进行 MQTT 上报与控制指令下发，实现远程环境感知与健康状态监测。

##  系统功能

  **GPS定位**：解析 `$GNGGA` 格式的 NMEA 协议，获取实时经纬度位置。
  **环境监测**：采集温度、湿度、光照强度。
  **健康监测**：
       - 实时心率检测（BPM）
       - 血氧饱和度计算（SpO₂）
       - HRV（心率变异性）推算身体活力与心理情绪状态
  **物联网通信**：
       - 通过 MQTT 协议连接华为 IoT 平台，支持：
       - 数据上报（环境 + 健康 + 经纬度）
       - 命令下发（控制LED灯和电机）

##  目录结构说明
├── gps.c # GPS 串口读取 + 定位功能<br>
├── iot_cloud_oc.c # 主入口，IoT 任务、MQTT通信、数据上报处理<br>
├── max30102_app.c # 心率和血氧数据采集与分析<br>
├── E53_IA1.c/h # 环境传感器模块（温度、湿度）<br>
├── wifi_connect.c/h # WiFi 连接配置<br>
├── oc_mqtt.c/h # MQTT通信接口<br>
├── BUILD.gn / makefile # 编译构建脚本<br>


---

##  编译与烧录

### 环境要求

-  **开发板**：BearPi-HM Nano
-  **工具链**：Hi3861V100R001C00SPC025 SDK + 鸿蒙OS OpenHarmony L0
-  **构建系统**：`ninja` + `python build.py`
-  **平台**：Linux 或 WSL 环境

## 使用说明

### 1. 硬件连接

- **GPS模块**  
  - 使用UART1接口连接，TXD连接GPIO6，RXD连接GPIO5。  
  - 确保GPS模块正常供电并在开阔环境下以获取定位信号。

- **MAX30102心率血氧传感器**  
  - 通过I2C接口连接，确保接线正确且传感器放置稳定。

- **环境传感器（E53_IA1）**  
  - 采集温度、湿度和光照数据，接线按照开发板规格连接。

- **控制输出**  
  - GPIO口（如IO2）用于控制蜂鸣器、LED灯或继电器，根据状态触发输出。

---

### 2. 软件配置

- **Wi-Fi连接**  
  修改 `iot_cloud_oc.c` 文件中的Wi-Fi配置参数：

  #define WIFI_SSID "你的WiFi名称"
  #define WIFI_PASS "你的WiFi密码"

## 运行与观察

### 1. 启动设备

- 将固件烧录完成后，连接开发板的串口调试工具（如串口助手或IDE串口终端）。  
- 通电启动设备，设备会自动初始化各传感器及模块，开始数据采集与上传。

### 2. 串口输出

- 启动后，串口终端会打印系统启动信息和各传感器的数据：  
  - GPS定位信息（经纬度、时间、定位状态）  
  - 环境传感器数据（光照、温度、湿度）  
  - 心率与血氧数据（心率值、血氧饱和度）  
  - 心率变异性（HRV）及心理情绪状态

- 示例输出：
[$GNGGA,WGS-84]经纬度数据 : 23.00000, 113.00000
SENSOR:lum:130.56 temp:26.48 hum:51.90
SENSOR:Heart_rate: 76
SO2: 98


### 3. 数据上传与云端监控

- 设备实时将传感器采集数据上传至华为云IoT平台。  
- 登录云平台后，可在设备管理界面查看实时数据，进行远程监控。  
- 支持实时图表和历史数据查询。

### 4. 云端命令响应

- 通过云平台下发的控制指令（如控制LED灯、蜂鸣器、继电器等）会被设备即时响应。  
- 命令执行结果及状态会同步反馈至云端。

### 5. 观察建议

- 建议在开阔环境测试GPS定位功能，避免室内或信号屏蔽区域。  
- 设备运行时保持稳定放置，减少震动以保证传感器数据准确。  
- 通过串口日志确认设备各模块初始化和运行状态。


通过以上步骤，用户可直观观察设备运行状况和采集数据，确保系统稳定可靠。


